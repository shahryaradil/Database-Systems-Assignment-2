-- CREATE DATABASE

CREATE DATABASE AssignmentTwo;

-- USE DATABASE

USE AssignmentTwo;

-- CREATE TABLES

CREATE TABLE PLANE_TYPE
(MODEL VARCHAR(20) NOT NULL PRIMARY KEY,
CAPACITY NUMERIC,
PLANE_WEIGHT NUMERIC)

CREATE TABLE HANGAR
(NUMBER NUMERIC NOT NULL PRIMARY KEY,
CAPACITY NUMERIC,
HANGAR_LOCATION VARCHAR(200))

CREATE TABLE AIRPLANE
(REGNO VARCHAR(7) NOT NULL PRIMARY KEY,
MODEL VARCHAR(20) NOT NULL
CONSTRAINT OF_TYPE FOREIGN KEY (MODEL)
REFERENCES PLANE_TYPE (MODEL)
ON DELETE CASCADE,
HNUMBER NUMERIC
CONSTRAINT STORED_IN FOREIGN KEY (HNUMBER)
REFERENCES HANGAR (NUMBER)
ON DELETE CASCADE)

CREATE TABLE CORPORATION
(CNAME VARCHAR(100) NOT NULL PRIMARY KEY,
CADDRESS VARCHAR(200),
PHONE NUMERIC(12))

CREATE TABLE PERSON
(SSN NUMERIC (13) NOT NULL PRIMARY KEY,
PNAME VARCHAR(50),
PADDRESS VARCHAR(200),
PHONE NUMERIC(12))

CREATE TABLE PLANE_OWNER
(OWNER_SSN NUMERIC(13) FOREIGN KEY (OWNER_SSN)
REFERENCES PERSON (SSN)
ON DELETE CASCADE,
CORP_NAME VARCHAR(100) FOREIGN KEY (CORP_NAME)
REFERENCES CORPORATION (CNAME)
ON DELETE CASCADE,
REGNO VARCHAR(7) NOT NULL
CONSTRAINT OWNS FOREIGN KEY (REGNO)
REFERENCES AIRPLANE (REGNO)
ON DELETE CASCADE,
PDATE DATE)

CREATE TABLE PILOT
(LIC_NUM NUMERIC(13) NOT NULL PRIMARY KEY,
RESTR VARCHAR(50),
MODEL VARCHAR(20) NOT NULL
CONSTRAINT FLIES FOREIGN KEY (MODEL)
REFERENCES PLANE_TYPE (MODEL)
ON DELETE CASCADE,
SSN NUMERIC(13) NOT NULL REFERENCES PERSON (SSN)
ON DELETE CASCADE)

CREATE TABLE EMPLOYEE
(ESHIFT VARCHAR(30),
SALARY NUMERIC,
MODEL VARCHAR(20) NOT NULL
CONSTRAINT WORKS_0N FOREIGN KEY (MODEL)
REFERENCES PLANE_TYPE (MODEL)
ON DELETE CASCADE,
SSN NUMERIC(13) NOT NULL PRIMARY KEY REFERENCES PERSON (SSN)
ON DELETE CASCADE)

CREATE TABLE AIRPLANE_SERVICE
(SERVICE_DATE DATE,
SERVICE_HOURS NUMERIC,
WORK_CODE NUMERIC,
REGNO VARCHAR(7) NOT NULL
CONSTRAINT PLANE_SERVICE FOREIGN KEY (REGNO)
REFERENCES AIRPLANE (REGNO)
ON DELETE CASCADE,
SSN NUMERIC(13) NOT NULL
CONSTRAINT MAINTAIN FOREIGN KEY (SSN)
REFERENCES EMPLOYEE (SSN))

-- ADD DATA

INSERT INTO PLANE_TYPE
VALUES ('Airbus A320', 150, 42000),
       ('Boeing 747', 416, 833000),
       ('Boeing 777', 396, 775000),
       ('Boeing 787', 330, 502500),
       ('Embraer E175', 76, 35850),
       ('Embraer E190', 114, 52163),
       ('Bombardier CRJ200', 50, 24400),
       ('Bombardier CRJ900', 90, 34473),
       ('Cessna Citation X', 12, 17195),
       ('Gulfstream G550', 18, 91300),
       ('Dassault Falcon 7X', 12, 41275),
       ('Airbus A330', 440, 242000),
       ('Airbus A350', 440, 268000),
       ('Airbus A380', 853, 575000),
       ('Boeing 737', 215, 77000),
       ('Boeing 757', 239, 115680),
       ('Boeing 767', 375, 159000),
       ('Boeing 777X', 425, 775000),
       ('Embraer E145', 50, 21200),
       ('Embraer E195', 132, 60500);

INSERT INTO HANGAR (NUMBER, CAPACITY, HANGAR_LOCATION)
VALUES (1, 5, 'A3'),
       (2, 8, 'B2'),
       (3, 4, 'C5'),
       (4, 10, 'D4'),
       (5, 2, 'E6'),
       (6, 1, 'F1'),
       (7, 3, 'G7'),
       (8, 6, 'H3'),
       (9, 9, 'J2'),
       (10, 5, 'K4'),
       (11, 4, 'L5'),
       (12, 7, 'M2'),
       (13, 2, 'N1'),
       (14, 6, 'P3'),
       (15, 4, 'Q4'),
       (16, 8, 'R2'),
       (17, 12, 'S4'),
       (18, 3, 'T7'),
       (19, 11, 'U3'),
       (20, 5, 'V5');

INSERT INTO AIRPLANE (REGNO, MODEL, HNUMBER)
VALUES ('N987AA', 'Boeing 787', 1),
       ('G-CIVB', 'Boeing 747', 2),
       ('N720RW', 'Embraer E175', 3),
       ('N127DL', 'Boeing 767', 4),
       ('N8311Q', 'Cessna Citation X', 5),
       ('VP-CLL', 'Gulfstream G550', 6),
       ('N2KE', 'Dassault Falcon 7X', 7),
       ('D-AIMB', 'Airbus A320', 8),
       ('G-FBEA', 'Embraer E190', 9),
       ('HB-JVN', 'Bombardier CRJ900', 10),
       ('N173GJ', 'Embraer E145', 11),
       ('N234CA', 'Airbus A350', 12),
       ('JA811A', 'Boeing 777', 13),
       ('HL7634', 'Boeing 737', 14),
       ('N8684A', 'Bombardier CRJ200', 15),
       ('N827NN', 'Embraer E195', 16),
       ('A6-EDV', 'Airbus A380', 15),
       ('N581JB', 'Airbus A320', 17),
       ('N776AN', 'Boeing 777X', 19),
       ('PH-BVP', 'Boeing 757', 20);

INSERT INTO CORPORATION (CNAME, CADDRESS, PHONE)
VALUES ('Acme Inc', '123 Main St, Karachi, Pakistan', 923001234567),
       ('Globex Corp', '456 Elm St, Lahore, Pakistan', 923002345678),
       ('Stark Industries', '789 Oak St, Islamabad, Pakistan', 923003456789),
       ('Wayne Enterprises', '246 Maple St, Peshawar, Pakistan', 923004567890),
       ('Umbrella Corporation', '135 Pine St, Quetta, Pakistan', 923005678901),
       ('Weyland-Yutani Corporation', '579 Cedar St, Karachi, Pakistan', 923006789012),
       ('InGen Inc', '802 Walnut St, Lahore, Pakistan', 923007890123),
       ('Oscorp Industries', '951 Spruce St, Islamabad, Pakistan', 923008901234),
       ('LexCorp', '864 Birch St, Rawalpindi, Pakistan', 923009012345),
       ('Spacely Space Sprockets', '357 Ash St, Karachi, Pakistan', 923010123456),
       ('Cogswell Cogs', '480 Chestnut St, Lahore, Pakistan', 923011234567),
       ('Monarch Sciences', '695 Poplar St, Islamabad, Pakistan', 923012345678),
       ('Nakatomi Corporation', '931 Magnolia St, Peshawar, Pakistan', 923013456789),
       ('Gringotts Wizarding Bank', '264 Lilac St, Quetta, Pakistan', 923014567890),
       ('St. Mungo''s Hospital for Magical Maladies and Injuries', '507 Daisy St, Karachi, Pakistan', 923015678901),
       ('Daily Bugle', '740 Tulip St, Lahore, Pakistan', 923016789012),
       ('Wakanda Design Group', '369 Rose St, Islamabad, Pakistan', 923017890123),
       ('Strickland Propane', '602 Petunia St, Rawalpindi, Pakistan', 923018901234),
       ('Thatherton Fuels', '985 Iris St, Karachi, Pakistan', 923019012345),
       ('Bob''s Burgers', '438 Sunflower St, Lahore, Pakistan', 923020123456);

INSERT INTO PERSON (SSN, PNAME, PADDRESS, PHONE)
VALUES (1112233334445, 'Ali Ahmed', '123 Main St, Karachi, Pakistan', 923001234567),
       (2223344445556, 'Sana Khan', '456 Elm St, Lahore, Pakistan', 923002345678),
       (3334455556667, 'Ahmed Ali', '789 Oak St, Islamabad, Pakistan', 923003456789),
       (4445566667778, 'Saima Javaid', '246 Maple St, Peshawar, Pakistan', 923004567890),
       (5556677778889, 'Jawad Siddiqui', '135 Pine St, Quetta, Pakistan', 923005678901),
       (6667788889990, 'Aisha Farooq', '579 Cedar St, Karachi, Pakistan', 923006789012),
       (7778899990001, 'Umar Shahid', '802 Walnut St, Lahore, Pakistan', 923007890123),
       (8889900001112, 'Hira Shoaib', '951 Spruce St, Islamabad, Pakistan', 923008901234),
       (9990011112223, 'Sami Khan', '864 Birch St, Rawalpindi, Pakistan', 923009012345),
       (1001111222234, 'Fatima Ahmed', '357 Ash St, Karachi, Pakistan', 923010123456),
       (1111222233345, 'Ali Raza', '480 Chestnut St, Lahore, Pakistan', 923011234567),
       (1222333344456, 'Sadia Zia', '695 Poplar St, Islamabad, Pakistan', 923012345678),
       (1333444455567, 'Muneeb Tariq', '931 Magnolia St, Peshawar, Pakistan', 923013456789),
       (1444555566678, 'Saira Azam', '264 Lilac St, Quetta, Pakistan', 923014567890),
       (1555666677789, 'Adeel Saeed', '507 Daisy St, Karachi, Pakistan', 923015678901),
       (1666777788890, 'Iqra Naeem', '740 Tulip St, Lahore, Pakistan', 923016789012),
       (1777888899901, 'Hammad Khan', '369 Rose St, Islamabad, Pakistan', 923017890123),
       (1888999900012, 'Neha Fatima', '602 Petunia St, Rawalpindi, Pakistan', 923018901234),
       (1999000011123, 'Aliya Riaz', '985 Iris St, Karachi, Pakistan', 923019012345),
       (2000111122234, 'Arslan Ali', '438 Sunflower St, Lahore, Pakistan', 923020123456);

INSERT INTO PERSON (SSN, PNAME, PADDRESS, PHONE)
	VALUES (2111122233345, 'Usman Khan', '173 Oak St, Islamabad, Pakistan', 923021234567),
	(2222233344456, 'Sadia Akram', '695 Maple St, Karachi, Pakistan', 923022345678),
	(2333344455567, 'Saad Ahmed', '480 Chestnut St, Lahore, Pakistan', 923023456789),
	(2444455566678, 'Nida Iqbal', '931 Magnolia St, Peshawar, Pakistan', 923024567890),
	(2555566677789, 'Ahsan Javed', '264 Lilac St, Quetta, Pakistan', 923025678901),
	(2666677788890, 'Rida Shah', '507 Daisy St, Karachi, Pakistan', 923026789012),
	(2777788899901, 'Adnan Ahmed', '740 Tulip St, Lahore, Pakistan', 923027890123),
	(2888899900012, 'Sana Riaz', '369 Rose St, Islamabad, Pakistan', 923028901234),
	(2999000011123, 'Muneeba Khalid', '602 Petunia St, Rawalpindi, Pakistan', 923029012345),
	(3000111122234, 'Amir Ali', '985 Iris St, Karachi, Pakistan', 923030123456),
	(3111122233345, 'Fatima Hassan', '173 Oak St, Islamabad, Pakistan', 923031234567),
	(3222233344456, 'Adeel Ahmed', '695 Maple St, Karachi, Pakistan', 923032345678),
	(3333344455567, 'Kamran Ali', '480 Chestnut St, Lahore, Pakistan', 923033456789),
	(3444455566678, 'Sadia Aslam', '931 Magnolia St, Peshawar, Pakistan', 923034567890),
	(3555566677789, 'Asma Khan', '264 Lilac St, Quetta, Pakistan', 923035678901),
	(3666677788890, 'Fahad Ahmed', '507 Daisy St, Karachi, Pakistan', 923036789012),
	(3777788899901, 'Sadia Ahmed', '740 Tulip St, Lahore, Pakistan', 923037890123),
	(3888899900012, 'Ali Raza', '369 Rose St, Islamabad, Pakistan', 923038901234),
	(3999000011123, 'Hina Javed', '602 Petunia St, Rawalpindi, Pakistan', 923039012345),
	(4000111122234, 'Usman Arshad', '985 Iris St, Karachi, Pakistan', 923040123456);

INSERT INTO PLANE_OWNER (OWNER_SSN, CORP_NAME, REGNO, PDATE) 
VALUES (2223344445556, NULL, 'N987AA', '2022-01-01'),
	   (1111222233345, NULL, 'G-CIVB', '2022-01-02'),
	   (NULL, 'Acme Inc', 'N720RW', '2022-01-03'),
	   (2000111122234, NULL, 'N127DL', '2022-01-04'),
	   (1888999900012, NULL, 'N8311Q', '2022-01-05'),
	   (NULL, 'Globex Corp', 'VP-CLL', '2022-01-06'),
	   (NULL, 'Wayne Enterprises', 'N2KE', '2022-01-07'),
	   (1666777788890, NULL, 'D-AIMB', '2022-01-08'),
	   (NULL, 'Umbrella Corporation', 'G-FBEA', '2022-01-09'),
	   (NULL, 'Stark Industries', 'HB-JVN', '2022-01-10'),
	   (1111222233345, NULL, 'N173GJ', '2022-01-11'),
	   (9990011112223, NULL, 'N234CA', '2022-01-12'),
	   (NULL, 'Oscorp Industries', 'JA811A', '2022-01-13'),
	   (7778899990001, NULL, 'HL7634', '2022-01-14'),
	   (5556677778889, NULL, 'N8684A', '2022-01-15'),
	   (NULL, 'Stark Industries', 'N827NN', '2022-01-16'),
	   (8889900001112, NULL, 'A6-EDV', '2022-01-17'),
	   (9990011112223, NULL, 'N581JB', '2022-01-18'),
	   (NULL, 'LexCorp', 'N776AN', '2022-01-19'),
	   (3334455556667, NULL, 'PH-BVP', '2022-01-20');

INSERT INTO PILOT (LIC_NUM, RESTR, MODEL, SSN) 
VALUES 
(1111111111111, 'None', 'Boeing 737', 1001111222234),
(2222222222222, 'Single engine only', 'Cessna Citation X', 1222333344456),
(3333333333333, 'None', 'Boeing 747', 1111222233345),
(4444444444444, 'Twin engine only', 'Airbus A320', 1112233334445),
(5555555555555, 'None', 'Boeing 737', 9990011112223),
(6666666666666, 'None', 'Boeing 747', 1333444455567),
(7777777777777, 'Multi-engine only', 'Airbus A380', 1444555566678),
(8888888888888, 'None', 'Boeing 777', 1555666677789),
(9999999999999, 'None', 'Boeing 787', 1666777788890),
(1111111111112, 'Single engine only', 'Embraer E145', 1777888899901),
(2222222222223, 'None', 'Boeing 747', 1888999900012),
(3333333333334, 'None', 'Airbus A320', 1999000011123),
(4444444444445, 'Twin engine only', 'Boeing 737', 2000111122234),
(5555555555556, 'None', 'Airbus A380', 2223344445556),
(6666666666667, 'Multi-engine only', 'Boeing 777', 3334455556667),
(7777777777778, 'None', 'Boeing 747', 4445566667778),
(8888888888889, 'None', 'Airbus A320', 5556677778889),
(9999999999990, 'None', 'Gulfstream G550', 6667788889990),
(1111111111113, 'Single engine only', 'Bombardier CRJ900', 7778899990001),
(2222222222224, 'None', 'Boeing 777X', 8889900001112);

INSERT INTO EMPLOYEE (ESHIFT, SALARY, MODEL, SSN) VALUES 
('Morning', 50000, 'Boeing 747', 2111122233345),
('Afternoon', 45000, 'Airbus A380', 2222233344456),
('Evening', 55000, 'Boeing 737', 2333344455567),
('Night', 60000, 'Boeing 747', 2444455566678),
('Morning', 40000, 'Airbus A320', 2555566677789),
('Afternoon', 55000, 'Boeing 737', 2666677788890),
('Evening', 45000, 'Boeing 787', 2777788899901),
('Night', 65000, 'Airbus A380', 2888899900012),
('Morning', 55000, 'Boeing 747', 2999000011123),
('Afternoon', 60000, 'Boeing 737', 3000111122234),
('Evening', 45000, 'Airbus A320', 3111122233345),
('Night', 50000, 'Boeing 787', 3222233344456),
('Morning', 60000, 'Boeing 747', 3333344455567),
('Afternoon', 55000, 'Airbus A380', 3444455566678),
('Evening', 45000, 'Boeing 737', 3555566677789),
('Night', 50000, 'Airbus A320', 3666677788890),
('Morning', 55000, 'Boeing 787', 3777788899901),
('Afternoon', 60000, 'Boeing 747', 3888899900012),
('Evening', 45000, 'Airbus A380', 3999000011123),
('Night', 50000, 'Boeing 737', 4000111122234);

INSERT INTO AIRPLANE_SERVICE (SERVICE_DATE, SERVICE_HOURS, WORK_CODE, REGNO, SSN) VALUES
('2022-01-01', 10, 1234, 'N987AA', 2111122233345),
('2022-02-02', 20, 2345, 'G-CIVB', 2222233344456),
('2022-03-03', 30, 3456, 'N720RW', 2333344455567),
('2022-04-04', 40, 4567, 'N127DL', 2444455566678),
('2022-05-05', 50, 5678, 'N8311Q', 2555566677789),
('2022-06-06', 60, 6789, 'VP-CLL', 2666677788890),
('2022-07-07', 70, 7890, 'N2KE', 2777788899901),
('2022-08-08', 80, 8901, 'D-AIMB', 2888899900012),
('2022-09-09', 90, 9012, 'G-FBEA', 2999000011123),
('2022-10-10', 100, 1011, 'HB-JVN', 3000111122234),
('2022-11-11', 110, 1112, 'N173GJ', 3111122233345),
('2022-12-12', 120, 1213, 'N234CA', 3222233344456),
('2023-01-01', 130, 1314, 'JA811A', 3333344455567),
('2023-02-02', 140, 1415, 'HL7634', 3444455566678),
('2023-03-03', 150, 1516, 'N8684A', 3555566677789),
('2023-04-04', 160, 1617, 'N827NN', 3666677788890),
('2023-05-05', 170, 1718, 'A6-EDV', 3777788899901),
('2023-06-06', 180, 1819, 'N581JB', 3888899900012),
('2023-07-07', 190, 1920, 'N776AN', 3999000011123),
('2023-08-08', 200, 2021, 'PH-BVP', 4000111122234);

--Queries

-- Q3

SELECT REGNO
FROM AIRPLANE
WHERE REGNO NOT IN (
    SELECT REGNO
    FROM AIRPLANE
);

--Q4

select PLANE_OWNER.CORP_NAME, CORPORATION.CADDRESS from PLANE_OWNER join CORPORATION on PLANE_OWNER.CORP_NAME = CORPORATION.CNAME where PLANE_OWNER.REGNO in
(select regno from AIRPLANE join PLANE_TYPE on AIRPLANE.MODEL = PLANE_TYPE.MODEL where CAPACITY > 200)

--Q5

SELECT AVG(EMPLOYEE.SALARY) AS 'AVERAGE' FROM EMPLOYEE WHERE EMPLOYEE.ESHIFT = 'NIGHT'

--Q6

SELECT TOP 10 EMPLOYEE.SSN, AIRPLANE_SERVICE.SERVICE_HOURS FROM EMPLOYEE JOIN AIRPLANE_SERVICE ON AIRPLANE_SERVICE.SSN = EMPLOYEE.SSN ORDER BY SERVICE_HOURS DESC

--Q7

SELECT AIRPLANE.REGNO, AIRPLANE.MODEL FROM AIRPLANE JOIN AIRPLANE_SERVICE ON AIRPLANE.REGNO = AIRPLANE_SERVICE.REGNO WHERE SERVICE_DATE >= '20230320' AND SERVICE_DATE <= '20230327' 

--Q8

SELECT PNAME, PHONE
FROM PERSON
INNER JOIN PLANE_OWNER ON PERSON.SSN = PLANE_OWNER.OWNER_SSN
WHERE PDATE >= DATEADD(month, -1, GETDATE())

--Q9

SELECT PILOT.SSN, COUNT(PILOT.MODEL) AS NUMBER_OF_PLANES
FROM PILOT
GROUP BY PILOT.SSN

--Q10

SELECT HANGAR_LOCATION, CAPACITY
FROM HANGAR
WHERE CAPACITY = (SELECT MAX(CAPACITY) FROM HANGAR);

--Q11

SELECT CORP_NAME, COUNT(REGNO) AS TOTAL_PLANES
FROM PLANE_OWNER
GROUP BY CORP_NAME
ORDER BY TOTAL_PLANES DESC

--Q12

SELECT MODEL, AVG(SERVICE_HOURS) AS AVG_HOURS
FROM AIRPLANE_SERVICE
INNER JOIN AIRPLANE ON AIRPLANE_SERVICE.REGNO = AIRPLANE.REGNO
GROUP BY MODEL

--Q13

SELECT DISTINCT PNAME
FROM PERSON
INNER JOIN PLANE_OWNER ON PERSON.SSN = PLANE_OWNER.OWNER_SSN
INNER JOIN AIRPLANE ON PLANE_OWNER.REGNO = AIRPLANE.REGNO
INNER JOIN AIRPLANE_SERVICE ON AIRPLANE.REGNO = AIRPLANE_SERVICE.REGNO
INNER JOIN EMPLOYEE ON AIRPLANE_SERVICE.SSN = EMPLOYEE.SSN
WHERE AIRPLANE.MODEL != EMPLOYEE.MODEL

--Q14

SELECT PNAME, PERSON.PHONE
FROM PERSON
INNER JOIN PLANE_OWNER ON PERSON.SSN = PLANE_OWNER.OWNER_SSN
INNER JOIN CORPORATION ON PLANE_OWNER.CORP_NAME = CORPORATION.CNAME
INNER JOIN HANGAR ON CORPORATION.CADDRESS = HANGAR.HANGAR_LOCATION
WHERE PADDRESS = HANGAR_LOCATION

--Q15

SELECT PERSON.PNAME AS PILOT_NAME
FROM PERSON
LEFT JOIN PILOT ON PERSON.SSN = PILOT.SSN
LEFT JOIN AIRPLANE ON PILOT.MODEL = AIRPLANE.MODEL
LEFT JOIN AIRPLANE_SERVICE ON AIRPLANE.REGNO = AIRPLANE_SERVICE.REGNO
WHERE AIRPLANE_SERVICE.SERVICE_DATE IS NOT NULL AND AIRPLANE_SERVICE.SERVICE_HOURS > 0

--Q16

SELECT PNAME, SUM(SERVICE_HOURS) AS TOTAL_HOURS
FROM PERSON
INNER JOIN EMPLOYEE ON PERSON.SSN = EMPLOYEE.SSN
INNER JOIN AIRPLANE_SERVICE ON EMPLOYEE.SSN = AIRPLANE_SERVICE.SSN
INNER JOIN AIRPLANE ON AIRPLANE_SERVICE.REGNO = AIRPLANE.REGNO
INNER JOIN PLANE_OWNER ON AIRPLANE.REGNO = PLANE_OWNER.REGNO
WHERE CORP_NAME = 'corporation_name'
GROUP BY PNAME
ORDER BY TOTAL_HOURS DESC

--Q17

SELECT AIRPLANE.REGNO, PERSON.PNAME AS OWNER_NAME
FROM AIRPLANE
LEFT JOIN PLANE_OWNER ON AIRPLANE.REGNO = PLANE_OWNER.REGNO
LEFT JOIN EMPLOYEE ON AIRPLANE.REGNO = EMPLOYEE.MODEL
LEFT JOIN PERSON ON PLANE_OWNER.OWNER_SSN = PERSON.SSN
WHERE PLANE_OWNER.CORP_NAME IS NULL AND EMPLOYEE.ESHIFT <> 'day';

--Q18

SELECT P.PNAME, P.PADDRESS
FROM PERSON P
JOIN PLANE_OWNER PO ON P.SSN = PO.OWNER_SSN
JOIN AIRPLANE A ON PO.REGNO = A.REGNO
JOIN CORPORATION C ON PO.CORP_NAME = C.CNAME
WHERE A.MODEL IN (
  SELECT A2.MODEL
  FROM AIRPLANE A2
  JOIN PLANE_OWNER PO2 ON A2.REGNO = PO2.REGNO
  JOIN CORPORATION C2 ON PO2.CORP_NAME = C2.CNAME
  WHERE C2.CNAME = C.CNAME AND PO2.PDATE >= DATEADD(month, -1, GETDATE())
);

--Q19

SELECT HNUMBER, COUNT(REGNO) AS TOTAL_PLANES
FROM AIRPLANE
GROUP BY HNUMBER

--Q20

SELECT AIRPLANE.MODEL, COUNT(AIRPLANE.REGNO) AS TOTAL_PLANES
FROM AIRPLANE
GROUP BY AIRPLANE.MODEL

--Q21

SELECT AIRPLANE.REGNO, COUNT(AIRPLANE_SERVICE.SERVICE_HOURS) AS TOTAL_SERVICES
FROM AIRPLANE
LEFT JOIN AIRPLANE_SERVICE ON AIRPLANE.REGNO = AIRPLANE_SERVICE.REGNO
GROUP BY AIRPLANE.REGNO

--Q22

SELECT EMPLOYEE.ESHIFT AS SHIFT, AVG(EMPLOYEE.SALARY) AS AVG_SALARY
FROM EMPLOYEE
GROUP BY EMPLOYEE.ESHIFT

--Q23

SELECT PERSON.PNAME AS OWNER_NAME, COUNT(PLANE_OWNER.REGNO) AS TOTAL_PLANES
FROM PERSON
LEFT JOIN PLANE_OWNER ON PERSON.SSN = PLANE_OWNER.OWNER_SSN
GROUP BY PERSON.PNAME

--Q24

SELECT PERSON.PNAME AS PILOT_NAME, COUNT(PILOT.MODEL) AS TOTAL_PLANES_AUTHORIZED
FROM PERSON
JOIN PILOT ON PERSON.SSN = PILOT.SSN
GROUP BY PERSON.PNAME

--Q25

--a)
--This query retrieves all airplanes of the model ‘Boeing 747’ from the AIRPLANE table. This could be useful for an airline company to keep track of their inventory of a specific model of airplane

SELECT * FROM AIRPLANE WHERE MODEL = 'Boeing 747'

--b)
--This query counts the number of pilots that are qualified to fly a ‘Boeing 747’ airplane. This could be useful for an airline company to ensure they have enough pilots to operate their flights

SELECT COUNT(*) AS 'NUM PILOTS' FROM PILOT WHERE MODEL = 'Boeing 747'

--c)
--This query calculates the average salary of all employees. This could be useful for a company to monitor their payroll expenses and make sure they are in line with their budget

SELECT AVG(SALARY) AS 'AVG SALARY' FROM EMPLOYEE

--d)
--This query retrieves the name and address of the owner of the airplane with registration number ‘ABC123’. This could be useful for a company to contact the owner of an airplane for maintenance or other purposes

SELECT PNAME, PADDRESS FROM PERSON INNER JOIN PLANE_OWNER ON PERSON.SSN = PLANE_OWNER.OWNER_SSN WHERE REGNO = 'ABC123'